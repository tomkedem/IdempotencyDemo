<div
  class="w-full max-w-7xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200/80"
>
  <div class="p-8 sm:p-12">
    <!-- Header Section -->
    <header class="text-center mb-12">
      <h1
        class="text-4xl sm:text-5xl font-extrabold text-gray-900 tracking-tight flex items-center justify-center gap-3"
      >
        <span class="material-icons text-blue-600 text-5xl">verified_user</span>
        <span>הבטחת אמינות בעידן הדיגיטלי: יישום אידמפוטנטיות</span>
      </h1>
      <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">
        הדגמה חיה של טיפול בבקשות רשת באופן עמיד, בטוח וצפוי, גם בתנאים של חוסר
        ודאות.
      </p>
    </header>

    <!-- Main Content Grid -->
    <div class="flex flex-col lg:flex-row gap-12 items-start">
      <!-- Left Column: Textual Content -->
  <div class="min-w-0 rtl:pl-8" style="flex-basis:50%; flex-grow:1; flex-shrink:1;">
        <section>
          <h2
            class="text-3xl font-bold text-gray-800 border-r-4 border-blue-500 pr-4 mb-6"
          >
            מהי אידמפוטנטיות (Idempotency)?
          </h2>
          <p class="text-lg text-gray-700 leading-relaxed">
            במחשוב, פעולה אידמפוטנטית היא פעולה שאם תתבצע פעם אחת או מספר פעמים,
            התוצאה הסופית של המערכת תהיה זהה. תכונה זו חיונית במערכות מבוזרות,
            בהן תקלות רשת עלולות לגרום לשליחה כפולה של בקשות. שרת המיישם
            אידמפוטנטיות מבטיח שפעולה קריטית (כמו חיוב לקוח או יצירת משלוח)
            תתבצע פעם אחת בלבד, לא משנה כמה פעמים הבקשה הגיעה.
          </p>
        </section>

        <section class="mt-12">
  <h2
    class="text-3xl font-bold text-gray-800 border-r-4 border-blue-500 pr-4 mb-6"
  >
    איך זה עובד? אלגוריתם הטיפול בבקשה
  </h2>
  <p class="text-lg text-gray-700 leading-relaxed mb-6">
    כדי להבטיח טיפול אידמפוטנטי, כל בקשה קריטית צריכה לכלול מפתח ייחודי הנקרא <code>Idempotency-Key</code>. 
    <strong>הקליינט</strong> מייצר את המפתח הזה על בסיס שילוב של שדות קבועים וייחודיים לבקשה (כגון מזהה לקוח, מזהה פעולה, סכום, פרטי משלוח), 
    ושולח אותו ב־Header של הבקשה לשרת. 
    אין לכלול ערכים משתנים כמו תאריך/שעה במפתח, כדי להבטיח שכל לחיצה על אותו כפתור תייצר בדיוק את אותו מפתח. 
    השרת משתמש במפתח כדי לזהות בקשות כפולות ולמנוע ביצוע חוזר של אותה פעולה. 
    התהליך מתבצע כך:
  </p>
  <ul class="space-y-4 text-lg">
    <li class="flex items-start">
      <span class="material-icons text-blue-500 mt-1 ml-3">vpn_key</span>
      <span>
        <strong>יצירת המפתח ושליחתו:</strong> הקליינט יוצר <code>Idempotency-Key</code> ייחודי לכל בקשה קריטית, על בסיס שדות קבועים, ושולח אותו ב־Header של הבקשה לשרת.
      </span>
    </li>
    <li class="flex items-start">
      <span class="material-icons text-green-500 mt-1 ml-3">search</span>
      <span>
        <strong>בדיקת קיום המפתח:</strong> השרת בודק בטבלה ייעודית במסד הנתונים האם כבר התקבלה בקשה עם אותו <code>Idempotency-Key</code>.
      </span>
    </li>
    <li class="flex items-start">
      <span class="material-icons text-purple-500 mt-1 ml-3">save</span>
      <span>
        <strong>שמירת המפתח והבקשה:</strong> אם המפתח לא קיים, השרת שומר אותו יחד עם נתוני הבקשה, כדי למנוע טיפול כפול בבקשות עתידיות עם אותו מפתח.
      </span>
    </li>
    <li class="flex items-start">
      <span class="material-icons text-orange-500 mt-1 ml-3">hourglass_top</span>
      <span>
        <strong>עיבוד הבקשה:</strong> השרת מבצע את הלוגיקה העסקית (למשל, יצירת משלוח), ושומר את תוצאת הפעולה (הצלחה או כישלון) יחד עם המפתח.
      </span>
    </li>
    <li class="flex items-start">
      <span class="material-icons text-red-500 mt-1 ml-3">replay</span>
      <span>
        <strong>טיפול בבקשות חוזרות:</strong> אם מתקבלת בקשה נוספת עם אותו <code>Idempotency-Key</code>, השרת לא מבצע שוב את הפעולה, אלא מחזיר מיד את התוצאה השמורה מהפעם הראשונה.
      </span>
    </li>
  </ul>
</section>
      </div>

      <!-- Right Column: Flowchart -->
      <div
        class="flex flex-col items-center justify-center bg-gray-50 p-8 rounded-lg border w-full"
        style="flex-basis:50%; flex-grow:1; flex-shrink:1; min-width:320px;padding: 0px;"
      >
        <figure class="w-full">
          <figcaption class="mt-2 text-center text-base text-gray-700 font-medium">
            תרשים זרימה המתאר את תהליך הטיפול בבקשה בשרת
          </figcaption>
          <img
            src="assets/images/Idempotency diagram.gif"
            alt="תרשים זרימה של אלגוריתם אידמפוטנטיות"
            class="h-auto object-contain rounded-md shadow-md border"
            style="width: 100%; max-width: 100%; height: auto;"
          />         
        </figure>
      </div>
    </div>
  </div>
</div>
